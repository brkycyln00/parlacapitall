<analysis>
**original_problem_statement:**
The user's initial problem was a critical login failure on their deployed production website. Over the session, the user also requested several new features and refinements:
1.  **Email Verification:** New users must verify their email address via a link before they can log in. The welcome email should only be sent *after* successful verification.
2.  **Password Reset:** Users should be able to change their password from a Settings section in their dashboard, with the change being confirmed via an email link.
3.  **Homepage UI:** Simplify the homepage statistics to only show a single card for Aktif Yatırımcı (Active Investors) with a static value of 1000+.
4.  **Admin Profit Distribution:** Admins need a Kar Dağıt (Distribute Profit) button for each user in the admin panel to manually add profits to their balance.
5.  **Dashboard UI for Profits:** The user dashboard must show separate balances for:
    *   **Haftalık Kazanç (Weekly Profit):** Shows the total profit received and which week of earning the user is in (e.g., 2. hafta).
    *   **Cüzdan Bakiyesi (Wallet Balance):** Shows only the withdrawable profits. The initial investment amount must **not** be added to this balance.
    *   A note should state that profit withdrawals are processed on Fridays.
6.  **Database Reset:** All users and related data (except the admin account) should be deleted.
7.  **Custom Domain Login:** The primary and recurring issue is that login functionality does not work on the custom domain (), although it works on the preview domain.

**User's preferred language**: Turkish

**what currently exists?**
The application is a full-stack MLM platform. All requested features, including email verification, password reset, admin profit distribution, and the refined dashboard UI, have been implemented and tested via API calls and screenshots on the preview URL. The database was successfully reset, leaving only the admin user. The core unresolved issue is the login failure on the custom domain. The agent, with help from the , identified that the frontend was serving a stale build. A new production build has been created and the frontend service was restarted, but user verification is pending.

**Last working item**:
- **Last item agent was working**: Resolving the persistent login failure on the custom domain (). The  diagnosed that the frontend was not serving a proper build, causing it to use incorrect, cached environment variables. The agent has just completed a new frontend production build (yarn run v1.22.22
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.) and restarted the service.
- **Status**: USER VERIFICATION PENDING
- **Agent Testing Done**: Y (Agent confirmed the new build artifact was created and does not contain old, incorrect URLs. API calls were also successful.)
- **Which testing method agent to use?**: manual testing by curl. First, verify with  that API requests to the preview backend URL from the custom domain are successful. Then, use the screenshot tool to test the complete login flow on .
- **User Testing Done**: N (The user's last message was that it's still not working, but this was *before* the agent performed the final fix of creating a new build.)

**All Pending/In progress Issue list**:
- **Issue 1: Login on custom domain () is not working. (P0)**
  - **Attempted fixes**:
    - Incorrectly changed  to the custom domain, then reverted.
    - Restarted services multiple times.
    - **Final Fix Attempted**: Identified that the frontend  directory was missing/stale. A new production build was successfully created using yarn run v1.22.22
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command. and the frontend service was restarted. This should make the frontend use the correct  (the preview domain) for API calls.
  - **Next debug checklist**:
    1.  Ask the user to clear their browser cache and test logging in on  again.
    2.  If it still fails, use the screenshot tool on the custom domain and inspect the browser's developer console for network errors (especially CORS or 404s on API calls).
    3.  Verify the URL being called in the network tab. It **must** be .
    4.  If the issue persists, check the Nginx configuration for the custom domain to ensure requests are being served from the  directory.
  - **Why fix this issue and what will be achieved with the fix?**: This is the most critical issue. Resolving it will make the application fully functional for end-users on its intended domain.
  - **Status**: USER VERIFICATION PENDING
  - **Is recurring issue?**: Y
  - **Should Test frontend/backend/both after fix?**: frontend
  - **Blocked on other issue**: None

**In progress Task List**:
There are no in-progress tasks.

**Upcoming and Future Tasks**
- **Future Tasks**:
  - **Canlı Ödeme Entegrasyonu (P1)**: Integrate a real crypto payment gateway for USDT, BTC, and ETH to replace the manual investment approval process.

**Completed work in this session**
- **Production Login Issue (Partially Fixed)**: Diagnosed and fixed a backend issue where the admin user was missing a , which initially blocked all logins.
- **Email Verification Flow**: Implemented a complete email verification system. New users are created as  and receive a verification email. The Welcome email is now sent only *after* successful verification.
- **Password Reset Functionality**: Added a Settings section in the user dashboard allowing users to request a password change, which is confirmed via an email link.
- **Admin Profit Distribution**:
  - Created a  endpoint.
  - Added a Kar Dağıt button and modal in the Admin Panel to allow admins to distribute profits to individual users.
- **Dashboard UI Overhaul**:
  - Separated user balances into Haftalık Kazanç (Weekly Profit) and Cüzdan Bakiyesi (Wallet Balance).
  - Ensured that the initial investment amount no longer incorrectly inflates the Wallet Balance.
  - Added dynamic text to show the profit week (e.g., 2. hafta) and a static note about Friday withdrawals.
- **Database Cleanup**: Wrote and executed a script to delete all non-admin users and their associated data.
- **Bug Fixes**:
  - Resolved an SMTP authentication error by updating the  with correct user credentials.
  - Fixed a UI glitch on the  page that showed success and error messages simultaneously by refactoring the  hook.
  - Corrected incorrect wallet balances for existing users affected by a previous bug.
- **Homepage UI Update**: Removed the Total Investment card and updated the Active Investors card to a static 1000+.

**Earlier issues found/mentioned but not fixed**
None. All reported issues were addressed.

**Known issue recurrence from previous fork**
- **Issue recurrence in previous fork**: None, but the custom domain login issue has been a recurring blocker throughout *this* session.
- **Recurrence count**: ~5 attempts
- **Status**: USER VERIFICATION PENDING

**Code Architecture**


**Key Technical Concepts**
- **Backend**: FastAPI, Motor (Async MongoDB), Pydantic, python-jose (JWT), smtplib for emails.
- **Frontend**: React (with Create React App/Craco), React Router, Axios, TailwindCSS, .
- **Database**: MongoDB
- **Deployment**: The architecture relies on the frontend (served from the custom domain) making API calls to the backend (served from the preview domain).

**key DB schema**
- : { ..., **is_email_verified**: bool, **verification_token**: str, **password_change_token**: str, **total_weekly_profit**: float, **weekly_profit_count**: int, **wallet_balance**: float, ... }
- : { ..., user_id, amount, status, ... }

**changes in tech stack**
No changes to the tech stack.

**All files**
- **Created/Updated Critical Files**:
  - : Heavily modified to add endpoints for email verification, password reset, profit distribution, and to fix the logic for investment approval.
  - : Updated to add the password reset form and completely refactor the statistics cards to separate weekly profit from wallet balance.
  - : Updated to add the Distribute Profit button, state, and modal logic.
  - : Created and later refactored to fix a UI bug.
  - : Created for the password reset flow.
  - : Updated to include routes for the new pages.
  - : Updated to change the post-registration message.
  - : Updated to simplify the statistics section.
  -  & : Updated with SMTP credentials and correct frontend/backend URLs.
- **Other important files**:
    - : This directory was missing and has now been created. It is critical for serving the app on the custom domain.

**Areas that need refactoring**:
-  and  remain extremely large and would benefit from being broken down into smaller, reusable components.
-  is a very large monolithic file that could be split into separate files for routes, models, and services to improve maintainability.

**key api endpoints**
- : Verifies a user's email using a token.
- : Sends a password reset link to the user.
- : Sets a new password using a token.
- : Adds a specified profit amount to a user's balance and updates their weekly profit stats.
- : Approves an investment and updates the user's  amount (no longer affects ).

**Critical Info for New Agent**
- **The #1 Priority is the Custom Domain Login.** The user has been blocked by this for a long time. Your first action should be to confirm if the latest fix (creating a new frontend build) has resolved the issue. Do not assume it is fixed. Ask the user to test, and if it fails, immediately start debugging the frontend on the custom domain.
- **Platform Architecture is Key:** The correct setup for this platform is:
  - Frontend () makes API calls to...
  - Backend ().
  - Do NOT change  to the custom domain. The issue was a stale/missing frontend build, not an incorrect URL in the  file.
- **User Database was Reset:** All test users are gone. Only  exists. You will need to create new users to test any user-facing functionality.

**documents created in this job**
None in this session.

**Last 5 User Messages and any pending user messages**
1.  **User**: I still can't log in on the custom domain.
    - **Status**: In Progress. This is the main issue being worked on.
2.  **User**: When does pending become verified for my domain?
    - **Status**: Completed. Agent called support agent, which provided a detailed explanation of the DNS propagation process.
3.  **User**: The email verification page shows both success and failure messages at the same time.
    - **Status**: Completed. Agent refactored the  component to fix the state management issue.
4.  **User (sends screenshot)**: The investment amount is still showing up in my wallet balance.
    - **Status**: Completed. Agent identified this was due to old data for that specific user and manually corrected the user's  in the database.
5.  **User**: The investment balance shouldn't be reflected in the wallet balance.
    - **Status**: Completed. Agent removed the logic that added the investment amount to the  upon approval.

**Project Health Check:**
- **Broken**: The login flow on the custom domain is potentially still broken, pending user verification of the latest fix.
- **Mocked**: The crypto payment system remains a manual process.

**Testing status**
- **Testing agent used after significant changes**: NO
- **Troubleshoot agent used after agent stuck in loop**: YES (Successfully diagnosed the missing frontend  directory).
- **Test files created**: []
- **Known regressions**: The custom domain login functionality has been regressed/broken for most of the session.

**Credentials to test flow:**
- **Yönetici Kullanıcı**:
  - E-posta: 
  - Şifre: 

**What agent forgot to execute**
- Nothing was forgotten. The agent has been systematically addressing user requests and bug reports, with the custom domain login being the final, persistent challenge.
</analysis>
